generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ENUMS
//

enum AssetStatus {
  available
  assigned
  maintenance
  decommissioned
}

enum PersonStatus {
  active
  inactive
  suspended
}

enum StorageType {
  SSD
  HDD
  M2
  NVMe
  eMMC
  Soldered
  Other
}

enum Condition {
  excellent
  good
  fair
  poor
}

enum SystemType {
  email
  glpi
  erp
  crm
}

enum SimPlanType {
  prepago
  postpago
  corporativo
}

enum SimStatus {
  activo
  inactivo
  suspendido
}

//
// MODELS
//

model Branch {
  id        Int      @id @default(autoincrement())
  name      String
  address   String?
  region    String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  people Person[]
  assets Asset[]
  assignmentHistories AssignmentHistory[]
}

model Department {
  id          Int     @id @default(autoincrement())
  name        String
  description String?

  people Person[]
}

model Role {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String?

  people Person[]
}

model Person {
  id           Int          @id @default(autoincrement())
  nationalId   String       @unique
  firstName    String
  lastName     String
  username     String?      @unique
  password     String?
  status       PersonStatus @default(active)
  departmentId Int?
  roleId       Int?
  branchId     Int?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  currentToken String?

  department Department? @relation(fields: [departmentId], references: [id])
  role       Role?       @relation(fields: [roleId], references: [id])
  branch     Branch?     @relation(fields: [branchId], references: [id])

  assets              Asset[]             @relation("PersonAssets")
  assignmentHistories AssignmentHistory[]
  credentials         Credential[]
}

model Asset {
  id               Int         @id @default(autoincrement())
  assetCode        String      @unique
  assetType        String
  serialNumber     String?     @unique
  brand            String?
  model            String?
  status           AssetStatus @default(available)
  branchId         Int?
  assignedPersonId Int?
  purchaseDate     DateTime?
  deliveryDate     DateTime?
  receivedDate     DateTime?
  notes            String?
  attributesJson   Json?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  branch         Branch?           @relation(fields: [branchId], references: [id])
  assignedPerson Person?           @relation("PersonAssets", fields: [assignedPersonId], references: [id], onDelete: SetNull)
  storageCapacities StorageCapacity[]
  assignmentHistories AssignmentHistory[]
  simCards SimCard[]
}

model StorageCapacity {
  id         Int         @id @default(autoincrement())
  assetId    Int
  type       StorageType
  capacityGb Int
  notes      String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  asset Asset @relation(fields: [assetId], references: [id])
}

model Ink {
  id           Int      @id @default(autoincrement())
  brand        String
  model        String
  color        String
  quantity     Int      @default(0)
  inkType      String?
  purchaseDate DateTime?
  usageDate    DateTime?
  notes        String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @default(now()) @map("updated_at")
}

model UtpCable {
  id            Int      @id @default(autoincrement())
  brand         String
  type          String
  material      String?
  lengthMeters  Decimal?   // Puedes usar Decimal ahora en PostgreSQL
  color         String?
  purchaseDate  DateTime?
  usageDate     DateTime?
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
}

model Rj45Connector {
  id            Int      @id @default(autoincrement())
  model         String
  quantityUnits Int      @default(0)
  material      String?
  type          String?
  purchaseDate  DateTime?
  usageDate     DateTime?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model PowerStrip {
  id           Int      @id @default(autoincrement())
  brand        String?
  model        String
  outletCount  Int?
  lengthMeters Decimal?   // Cambiado de Float a Decimal (mejor precisi√≥n)
  color        String?
  capacity     Int?
  purchaseDate DateTime?
  usageDate    DateTime?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model AssignmentHistory {
  id               Int        @id @default(autoincrement())
  assetId          Int
  personId         Int
  branchId         Int?
  assignmentDate   DateTime   @default(now())
  returnDate       DateTime?
  deliveryCondition Condition @default(good)
  returnCondition  Condition?
  deliveryNotes    String?
  returnNotes      String?

  asset   Asset   @relation(fields: [assetId], references: [id])
  person  Person  @relation(fields: [personId], references: [id])
  branch  Branch? @relation(fields: [branchId], references: [id])
}

model Credential {
  id        Int        @id @default(autoincrement())
  personId  Int
  username  String
  password  String
  system    SystemType
  notes     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  person   Person @relation(fields: [personId], references: [id])
}

model SimCard {
  id             Int         @id @default(autoincrement())
  assetId        Int
  carrier        String
  phoneNumber    String      @unique
  planType       SimPlanType
  status         SimStatus   @default(activo)
  activationDate DateTime?
  notes          String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  asset Asset @relation(fields: [assetId], references: [id])
}
